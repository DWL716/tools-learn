<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      .box {
        width: 400px;
        height: 600px;
        margin: 0 auto;
        overflow: hidden;
        margin-top: 50px;
        position: relative;
      }
      .box img {
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div class="box">
      <img id="zoom-img" src="./乌孙.png" alt="" />
    </div>

    <script type="text/javascript">
      let ratol = 1;
      let zoomImg = document.querySelector("#zoom-img");
      let zoomBox = document.querySelector(".box");
      let def_w = zoomImg.getBoundingClientRect().width;
      let def_h = zoomImg.getBoundingClientRect().height;

      function zoom(delta, e) {
        let orgiin_Left = e.clientX - e.target.getBoundingClientRect().left;
        let orgiin_Top = e.clientY - e.target.getBoundingClientRect().top;
        let box_Left = e.clientX - zoomBox.getBoundingClientRect().left;
        let box_Top = e.clientY - zoomBox.getBoundingClientRect().top;

        let xx_L = e.target.getBoundingClientRect().left - 319;
        let xx_T = e.target.getBoundingClientRect().top - 50;

        var factor = 0.8;
        if (delta < 0) {
          factor = 1 / factor;
        }

        // 放大缩小图像。
        // image.setScaleX(image.getScaleX() * factor);
        console.log("--", e.target.getBoundingClientRect().width);
        // e.target.style.width =
        //   e.target.getBoundingClientRect().width * factor + "px";

        // image.setScaleY(image.getScaleY() * factor);
        // e.target.style.height =
        //   e.target.getBoundingClientRect().height * factor + "px";

        e.target.style.transform = `scale(${1 * factor})`;

        // 计算缩放位置的位移。
        console.log("ccc", xx_L, currentMouseX);
        // var dx = (currentMouseX - image.getLeft()) * (factor - 1)
        var dx = (currentMouseX - xx_L) * (factor - 1);
        // var  dy = (currentMouseX - image.getTop()) * (factor - 1);
        var dy = (currentMouseY - xx_T) * (factor - 1);

        console.log("dx", dx, xx_L);
        // 补偿位移。
        // image.setLeft(image.getLeft() - dx);
        e.target.style.left = xx_L - dx + "px";
        // image.setTop(image.getTop() - dy);
        e.target.style.top = xx_T - dy + "px";
      }

      zoomImg.onmousewheel = function (e) {
        var delta = event.wheelDelta / 120;
        zoom(delta, e);
        event.preventDefault() && false;
      };

      zoomBox.onmousemove = function (e) {
        currentMouseY = Math.round(
          e.clientX - e.target.getBoundingClientRect().left
        );
        currentMouseX = Math.round(
          e.clientY - e.target.getBoundingClientRect().top
        );

        console.log("ddddd", currentMouseY, currentMouseX);
      };
    </script>
  </body>
</html>
