<!DOCTYPE html>
<html>
  <body style="height: 2000px; background: #999">
    <canvas id="imageCanvas" width="800" height="600"
      >Your browser does not support HTML5 Canvas</canvas
    >
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.5.0/fabric.js"></script>
    <script>
      var img = document.createElement("img");
      img.src =
        "https://st.motortrend.com/uploads/sites/5/2018/11/2019-Mazda3-hatch-profile.jpg";
      var canvas = (window._canvas = new fabric.Canvas("imageCanvas"));

      $(img).on("load", function () {
        image = new fabric.Image(img, {
          centeredRotation: true,
          centeredScaling: true,
          top: 0,
          left: 0,
        });
        canvas.add(image);
      });

      canvas.on("mouse:move", function (event) {
        currentMouseY = Math.round(event.e.y - canvas._offset.top);
        currentMouseX = Math.round(event.e.x - canvas._offset.left);
        console.log("ddddd", currentMouseY, currentMouseX);
      });

      function zoom(delta, target) {
        var factor = 0.8;
        if (delta < 0) {
          factor = 1 / factor;
        }

        // 放大缩小图像。
        console.log("lo", image.getScaleX());
        image.setScaleX(image.getScaleX() * factor);
        image.setScaleY(image.getScaleY() * factor);
        // 计算缩放位置的位移。
        var dx = (currentMouseX - image.getLeft()) * (factor - 1),
          dy = (currentMouseY - image.getTop()) * (factor - 1);
        // 补偿位移。
        console.log("--", image.getLeft(), dx);
        image.setLeft(image.getLeft() - dx);
        image.setTop(image.getTop() - dy);

        canvas.renderAll();
      }

      $(canvas.wrapperEl).on("mousewheel", function (event) {
        var target = canvas.findTarget(event);
        if (target) {
          var delta = event.originalEvent.wheelDelta;
          zoom(delta, target);
        }
        event.preventDefault() && false;
      });

      // var img = document.createElement("img");
      // img.src =
      //   "https://img.zcool.cn/community/0186025d143ecaa8012051cd9c2eb7.jpg@1280w_1l_2o_100sh.jpg";
      // var canvas = (window._canvas = new fabric.Canvas("imageCanvas"));

      // $(img).on("load", function () {
      //   imgInstance = new fabric.Image(img, {
      //     centeredRotation: true,
      //     centeredScaling: true,
      //     top: 0,
      //     left: 0,
      //   });
      //   canvas.add(imgInstance);
      // });

      // canvas.on("mouse:move", function (event) {
      //   currentMouseY = Math.round(event.e.y - canvas._offset.top);
      //   currentMouseX = Math.round(event.e.x - canvas._offset.left);
      // });

      // function zoom(delta, target) {
      //   var myMouseX, myMouseY;

      //   console.log("currentMouseX" + currentMouseX);
      //   console.log("currentMouseY" + currentMouseY);

      //   imgInstance.scaleX += 0.2;
      //   imgInstance.scaleY += 0.2;

      //   canvas.renderAll();

      //   imgInstance.setCoords();

      //   var newMousX = currentMouseX * 0.2;
      //   var newMousY = currentMouseY * 0.2;

      //   console.log("newMousX" + newMousX);
      //   console.log("newMousY" + newMousY);

      //   imgInstance.set({
      //     top: imgInstance.getTop() - newMousY,
      //     left: imgInstance.getLeft() - newMousX,
      //   });

      //   console.log("imageY" + imgInstance.getTop());
      //   console.log("imageX" + imgInstance.getLeft());

      //   canvas.renderAll();

      //   imgInstance.setCoords();
      //   console.log(imgInstance.getBoundingRect());

      //   return false;
      // }

      // $(canvas.wrapperEl).on("mousewheel", function (e) {
      //   var target = canvas.findTarget(e);
      //   if (target) {
      //     if (e.wheelDelta > 0) {
      //       var delta = e.originalEvent.wheelDelta / 120;
      //       zoom(delta, target);
      //     } else {
      //       var delta = e.originalEvent.wheelDelta / 120;
      //       zoom(delta, target);
      //     }
      //   }
      //   e.preventDefault() && false;
      // });
    </script>
  </body>
</html>
