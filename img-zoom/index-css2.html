<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      .box {
        width: 400px;
        height: 600px;
        margin: 0 auto;
        overflow: hidden;
        margin-top: 50px;
        position: relative;
      }
      .box img {
        display: block;
        transform-origin: left top;
        /* position: absolute;
        top: 0;
        left: 0; */
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div class="box">
      <img id="zoom-img" src="./乌孙.png" alt="" />
    </div>

    <script type="text/javascript">
      let ratol = 1;
      let zoomImg = document.querySelector("#zoom-img");
      let zoomBox = document.querySelector(".box");
      let def_w = zoomImg.getBoundingClientRect().width;
      let def_h = zoomImg.getBoundingClientRect().height;
      let setp = 18;
      let isT = true;
      let old_l = 0;
      let old_t = 0;

      let imgDom = document.querySelector("#zoom-img");

      const changeToBoxOrigin = (x, y) => {
        let imgRect = imgDom.getBoundingClientRect();
        let imgCenterX = imgRect.left; // 如容器不在左上角，得减去容器坐标
        let imgCenterY = imgRect.top;
        return { x: x - imgCenterX, y: y - imgCenterY };
      };
      const changeToImageOrigin = (x, y) => {
        let imgRect = imgDom.getBoundingClientRect();
        let imgCenterX = imgRect.left + imgRect.width / 2; // 如容器不在左上角，得减去容器坐标
        let imgCenterY = imgRect.top + imgRect.height / 2;
        return { x: x - imgCenterX, y: y - imgCenterY };
      };

      let scale = 1;
      const _offset = [0, 0];
      const _scale = (s, event) => {
        let x = event.x,
          y = event.y;
        let { x: x1, y: y1 } = changeToImageOrigin(x, y);
        let ratio = s / scale;
        let xOffset = x1 * (ratio - 1);
        let yOffset = y1 * (ratio - 1);
        scale = s;

        // 设置style
        imgDom.style = `
            transform: translate(${_offset[0] + xOffset}px, ${
          _offset[1] + yOffset
        }px) scale(${s})
          `;
      };

      zoomImg.onmousewheel = function (e) {
        // console.log("向上滑", e, zoomImg.getBoundingClientRect());
        // let orgiin_Left = e.clientX - e.target.getBoundingClientRect().left;
        // let orgiin_Top = e.clientY - e.target.getBoundingClientRect().top;
        // console.log(orgiin_Left, orgiin_Top);

        // if (old_l === 0 || old_t == 0) {
        //   old_l = orgiin_Left;
        //   old_t = orgiin_Top;
        // }

        // // if (old_l !== orgiin_Left || old_t !== orgiin_Top) {
        // //   old_l = orgiin_Left;
        // //   old_t = orgiin_Top;
        // // }

        // if (e.wheelDelta > 0) {
        //   console.log("向上滑");
        //   e.target.style.transform = `scale(${(ratol += 0.1)})`;
        // } else {
        //   console.log("向下滑", zoomImg.getBoundingClientRect().width);
        //   e.target.style.transform = `scale(${(ratol -= 0.1)})`;
        //   if (
        //     def_w >= zoomImg.getBoundingClientRect().width ||
        //     def_h >= zoomImg.getBoundingClientRect().height
        //   ) {
        //     console.log("超出范围了");
        //     ratol = 1;
        //     e.target.style.transform = "scale(1)";
        //   }
        // }
        if (e.wheelDelta > 0) {
          _scale(scale + 0.1, e);
        } else {
          _scale(scale - 0.1, e);
        }
      };
    </script>
  </body>
</html>
